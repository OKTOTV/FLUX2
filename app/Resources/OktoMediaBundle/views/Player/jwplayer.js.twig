<script src="{{ player_url|raw }}"></script>
<script type="text/javascript">
    $(document).ready(function() {
        var playerInstance = jwplayer("{{ player_id }}");
        playerInstance.setup({
            {# logo:   {{ origin(episode)|raw }}, #}
            playlist: "{{ url('oktolab_media_player_for_episode', {'uniqID': episode.uniqID, 'player_type': 'jwplayer', '_format': 'json'})|raw}}",
            related: {
                    file: "{{ url('oktothek_show_similar_episode', {'uniqID': episode.uniqID})|raw }}",
                    onclick: "link"
            }
        }).on('play', function(event){
            if (event.oldstate == "buffering") { {# fire statistics #}
                $.ajax({
                    url: "{{ url('bprs_analytics_write_log')}}",
                    data: {'identifier': "{{ episode.uniqID }}", 'value': 'start'}
                });
            }
        }).on('complete', function(event) {
            $.ajax({
                url: "{{ url('bprs_analytics_write_log')}}",
                data: {'identifier': "{{ episode.uniqID}}", 'value': 'end'}
            });
        }).on('time', function(event) {
            var percentage = Math.floor(event.position*100 / event.duration);

            if ( percentage == 20 ) {
                console.log('reached 20%');
                $.ajax({
                    url: "{{ url('bprs_analytics_write_log')}}",
                    data: {'identifier': "{{ episode.uniqID}}", 'value': percentage+'%'}
                });
            } else if ( percentage == 40 ) {
                $.ajax({
                    url: "{{ url('bprs_analytics_write_log')}}",
                    data: {'identifier': "{{ episode.uniqID}}", 'value': percentage+'%'}
                });
            } else if (percentage == 60 ) {
                $.ajax({
                    url: "{{ url('bprs_analytics_write_log')}}",
                    data: {'identifier': "{{ episode.uniqID}}", 'value': percentage+'%'}
                });
            } else if ( percentage == 80 ) {
                $.ajax({
                    url: "{{ url('bprs_analytics_write_log')}}",
                    data: {'identifier': "{{ episode.uniqID}}", 'value': percentage+'%'}
                });
            }
        });
    });
</script>
