{% extends "BprsStyleBundle::layout.html.twig" %}

{% block nav_head%}
    {% include 'BprsStyleBundle::menu.html.twig' with {'selected': 'oktothek', 'dropdown': ''} %}
{% endblock %}
{% block body %}

    <div class="episode">
        <div id="player">
            {% if episode.video is empty %}
                <img src="{{ episode.posterframe|path }}" class="img-responsive" />
            {% endif %}
        </div>
        <div class="series">
            <a href="{{ path('oktothek_show_series', {'uniqID': episode.series.uniqID}) }}">{{ episode.series.name }}</a>
        </div>
        <div class="name">
            {{ episode.name }}
        </div>
        <div class="date">
            {{ episode.onlineStart|date('d.m.Y')}}
        </div>
        <div class="description">
            {{ episode.description }}
        </div>
        <div class="misc">
            <a href="#" id="favorite" data-uniqID="{{episode.uniqID}}"><span class="glyphicon glyphicon-heart-empty"></span> {{ episode.users|length}}</a>
        </div>
    </div>

    <div class="more">
        <h1>{{ 'oktothek_show_episode.more_from_this_series'|trans }}</h1>
        {% include 'AppBundle::Default/EpisodeStack.html.twig' with {'episodes': related} %}
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="http://content.jwplatform.com/libraries/qecJHTsP.js"></script>
    {% if episode.video is not empty %}
        <script type="text/javascript">
            var playerInstance = jwplayer("player");
            playerInstance.setup({
                file: "{{ episode.video|path }}",
                image: "{{ episode.posterframe|path }}"
            });
        </script>
    {% endif %}
    <script type="text/javascript">
        $('[data-toggle="tooltip"]').tooltip({'placement': 'auto top'});
        $('#favorite').click(function(e){
            e.preventDefault();
            // console.log('clicked favorite');
            $.ajax({
                url: "{{ path('backend_add_favourite') }}",
                data: { 'uniqID': '{{ episode.uniqID }}', 'type': 'episode'},
                type: 'POST',
                success: function(data) {
                    // console.log('success');
                    $(this)
                }
            })
        });
    </script>
{% endblock %}
